# Docs referenced:
# https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/
# https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/
# https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/
# https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/
# https://kubernetes.io/docs/tasks/configure-pod-container/security-context/
apiVersion: v1
kind: Namespace
metadata:
  name: litecoin
---
# Generated by kubectl create deploy --image devzx/litecoin:0.18.1 --dry-run=client -oyaml litecoin > statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  labels:
    app: litecoin
  name: litecoin
  namespace: litecoin
spec:
  serviceName: litecoin
  replicas: 3
  selector:
    matchLabels:
      app: litecoin
  template:
    metadata:
      labels:
        app: litecoin
    spec:
      automountServiceAccountToken: false
      securityContext:
        runAsUser: 10001
        runAsGroup: 10001
        fsGroup: 10001
        runAsNonRoot: true
      containers:
        - image: devzx/litecoin:0.18.1
          name: litecoin
          ports:
            - containerPort: 9333
              name: litecoin
          volumeMounts:
            - name: litecoin-data
              mountPath: /home/litecoin/.litecoin
          securityContext:
            readOnlyRootFilesystem: true
          resources:
            # https://blog.coinbase.com/a-beginners-guide-to-litecoin-d9b455d44cd3
            # According to this article memory is of more importance for litecoin than CPU
            # Without being able to benchmark litecoin these values should be considered placeholders
            limits:
              cpu: 125m
              memory: 5Gi
            requests:
              cpu: 100m
              memory: 4Gi
          livenessProbe:
            tcpSocket:
              port: litecoin
            initialDelaySeconds: 15
            periodSeconds: 20
  volumeClaimTemplates:
    - metadata:
        name: litecoin-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            # https://bitinfocharts.com/litecoin/
            # Blockchain currently at 55GB.
            # Provisioning 128GB to allow room for growth
            storage: 128Gi
